<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Cuisine</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-green-100 to-yellow-50 min-h-screen py-6 px-2 font-sans">
    <!-- Navbar moderne -->
    <nav class="sticky top-0 z-50 bg-gradient-to-r from-blue-100 via-green-100 to-yellow-100/80 backdrop-blur shadow-lg rounded-2xl px-4 py-3 mb-8 flex flex-col md:flex-row items-center justify-between gap-4 border border-blue-200">
        <!-- Logo et titre -->
        <div class="flex items-center gap-3">
            <span class="text-3xl">üë®‚Äçüç≥</span>
            <span id="navbar-title" class="text-xl font-extrabold text-blue-900 tracking-tight drop-shadow">Espace Cuisine</span>
        </div>
        <!-- Langue + D√©connexion √† droite -->
        <div class="flex items-center gap-2">
            <select id="language" onchange="changeLanguage()" class="px-3 py-2 rounded-lg border border-blue-300 bg-white text-blue-900 font-semibold focus:outline-none shadow">
                <option value="fr">Fran√ßais</option>
                <option value="en">English</option>
                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            </select>
            <a href="{% url 'cuisinier_logout' %}" id="logout-btn"
               class="px-4 py-2 rounded-full bg-gradient-to-r from-red-400 to-red-600 text-white font-bold hover:from-red-500 hover:to-red-700 shadow transition text-base">
                D√©connexion
            </a>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto">
        <h1 id="main-title" class="text-lg md:text-xl font-bold text-blue-800 mb-4 flex items-center gap-2">
            <span class="text-2xl">üë®‚Äçüç≥</span> Toutes les commandes √† la cuisine
        </h1>
        <div class="flex justify-end mb-4">
            <label class="flex items-center gap-2 cursor-pointer select-none">
                <input type="checkbox" id="toggle-served" class="accent-blue-600 w-4 h-4">
                <span id="hide-served-label" class="text-blue-800 text-sm font-semibold">Cacher les plats servis</span>
            </label>
        </div>
        {% if orders %}
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            {% for order in orders %}
                <section class="order-section bg-white rounded-lg border border-gray-200 p-3 md:p-4 text-sm"
                    data-order-status="{{ order.status }}">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="font-bold text-blue-800 text-base flex items-center gap-1">
                            üçΩÔ∏è #{{ order.id }} ‚Äî Table {{ order.table.number }}
                        </h2>
                        <span class="px-2 py-0.5 rounded-full text-xs font-semibold
                            {% if order.status == 'nouvelle' %} bg-red-100 text-red-700
                            {% elif order.status == 'preparation' %} bg-yellow-100 text-yellow-800
                            {% elif order.status == 'prete' %} bg-green-100 text-green-800
                            {% elif order.status == 'servie' %} bg-gray-200 text-gray-700
                            {% else %} bg-blue-100 text-blue-700
                            {% endif %}">
                            {{ order.get_status_display }}
                        </span>
                    </div>
                    <div class="space-y-2">
                        {% for item in order.sorted_items %}
                            <div class="item-block flex items-center gap-2 border border-gray-100 rounded p-2 bg-gray-50"
                                 data-item-status="{{ item.statut }}">
                                {% if item.item.image %}
                                    <img src="{{ item.item.image.url }}" alt="{{ item.item.name }}" class="w-8 h-8 object-cover rounded">
                                {% else %}
                                    <img src="https://via.placeholder.com/32x32?text=Img" alt="Pas d'image" class="w-8 h-8 object-cover rounded">
                                {% endif %}
                                <span class="font-medium text-blue-900 truncate">{{ item.item.name }}</span>
                                <span class="text-gray-700 font-semibold ml-auto">x{{ item.quantity }}</span>
                                <span class="inline-block px-2 py-0.5 rounded-full text-xs font-bold
                                    {% if item.statut == 'nouvelle' %} bg-red-400 text-white
                                    {% elif item.statut == 'preparation' %} bg-yellow-300 text-gray-900
                                    {% elif item.statut == 'prete' %} bg-green-500 text-white
                                    {% elif item.statut == 'servie' %} bg-gray-300 text-white
                                    {% else %} bg-gray-200 text-gray-700
                                    {% endif %}">
                                    {{ item.get_statut_display }}
                                </span>
                                {% if item.statut == 'nouvelle' or item.statut == 'preparation' %}
                                <form method="post" action="{% url 'update_orderitem_status' item.id %}" class="flex gap-1 items-center ml-2">
                                    {% csrf_token %}
                                    <select name="statut" class="rounded border px-1 py-0.5 text-xs bg-white">
                                        {% if item.statut == 'nouvelle' %}
                                            <option value="preparation">Pr√©paration</option>
                                            <option value="prete">Pr√™t</option>
                                        {% elif item.statut == 'preparation' %}
                                            <option value="prete">Pr√™t</option>
                                        {% endif %}
                                    </select>
                                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded text-xs">OK</button>
                                </form>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    <div class="flex justify-end mt-3">
                        {% if order.status == 'nouvelle' %}
                            <form method="post" action="{% url 'update_order_status' order.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="status" value="preparation">
                                <button type="submit" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold px-3 py-1 rounded text-xs">
                                    Tout en pr√©paration
                                </button>
                            </form>
                        {% elif order.status == 'preparation' %}
                            <form method="post" action="{% url 'update_order_status' order.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="status" value="prete">
                                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold px-3 py-1 rounded text-xs">
                                    Tout pr√™t
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </section>
            {% endfor %}
            </div>
        {% else %}
            <div class="bg-white rounded-lg p-6 text-center text-base text-gray-400 mt-10">
                Aucune commande √† pr√©parer.
            </div>
        {% endif %}
    </main>

    <footer class="mt-16 text-center">
        <div class="flex flex-col items-center gap-2 py-6">
            <div class="flex items-center gap-2 justify-center">
                <span class="text-2xl">üçΩÔ∏è</span>
                <span class="text-blue-700 font-bold text-lg" id="footer-title">Menu QR Cuisine</span>
            </div>
            <p class="text-gray-500 text-sm" id="footer-madeby">
                &copy; {{ now|date:"Y" }} R√©alis√© par HECHANE Abdellah. Tous droits r√©serv√©s.
            </p>
            <div class="flex gap-2 justify-center mt-1">
                <span class="inline-block w-2 h-2 rounded-full bg-blue-400"></span>
                <span class="inline-block w-2 h-2 rounded-full bg-green-400"></span>
                <span class="inline-block w-2 h-2 rounded-full bg-yellow-400"></span>
            </div>
        </div>
    </footer>

    <script>
        // Cacher/afficher les plats servis
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('toggle-served');
            toggle.addEventListener('change', function() {
                document.querySelectorAll('.item-block').forEach(block => {
                    if (toggle.checked && block.dataset.itemStatus === 'servie') {
                        block.classList.add('hidden');
                    } else {
                        block.classList.remove('hidden');
                    }
                });
            });
        });

        // --- Gestion multilingue ---
        const translations = {
            fr: {
                navbarTitle: "üë®‚Äçüç≥ Espace Cuisine",
                logout: "D√©connexion",
                mainTitle: "üë®‚Äçüç≥ Toutes les commandes √† la cuisine",
                hideServed: "Cacher les plats servis",
                menuCuisine: "Menu QR Cuisine",
                madeBy: "R√©alis√© par HECHANE Abdellah & FINIGUE Lahcen. Tous droits r√©serv√©s.",
                statusNouvelle: "Nouvelle",
                statusPreparation: "Pr√©paration",
                statusPrete: "Pr√™te",
                statusServie: "Servie",
                ok: "OK",
                allPreparation: "Tout en pr√©paration",
                allReady: "Tout pr√™t",
                noOrders: "Aucune commande √† pr√©parer.",
                date: "Date",
                total: "Total",
                cancel: "Annuler",
                errorLoad: "Erreur lors du chargement des commandes."
            },
            en: {
                navbarTitle: "üë®‚Äçüç≥ Kitchen Area",
                logout: "Logout",
                mainTitle: "üë®‚Äçüç≥ All kitchen orders",
                hideServed: "Hide served dishes",
                menuCuisine: "QR Menu Kitchen",
                madeBy: "Made by HECHANE Abdellah & FINIGUE Lahcen. All rights reserved.",
                statusNouvelle: "New",
                statusPreparation: "Preparation",
                statusPrete: "Ready",
                statusServie: "Served",
                ok: "OK",
                allPreparation: "All to preparation",
                allReady: "All ready",
                noOrders: "No orders to prepare.",
                date: "Date",
                total: "Total",
                cancel: "Cancel",
                errorLoad: "Error loading orders."
            },
            ar: {
                navbarTitle: "üë®‚Äçüç≥ ŸÇÿ≥ŸÖ ÿßŸÑŸÖÿ∑ÿ®ÿÆ",
                logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
                mainTitle: "üë®‚Äçüç≥ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ÿßŸÑŸÖÿ∑ÿ®ÿÆ",
                hideServed: "ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ£ÿ∑ÿ®ÿßŸÇ ÿßŸÑŸÖŸÇÿØŸÖÿ©",
                menuCuisine: "ŸÇÿßÿ¶ŸÖÿ© QR ŸÑŸÑŸÖÿ∑ÿ®ÿÆ",
                madeBy: "ÿ£ŸÜÿ¨ÿ≤Ÿá HECHANE Abdellah Ÿà FINIGUE Lahcen. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.",
                statusNouvelle: "ÿ¨ÿØŸäÿØ",
                statusPreparation: "ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±",
                statusPrete: "ÿ¨ÿßŸáÿ≤",
                statusServie: "ŸÖŸÇÿØŸÖ",
                ok: "ŸÖŸàÿßŸÅŸÇ",
                allPreparation: "ÿ¨ŸÖŸäÿπŸáÿß ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±",
                allReady: "ÿ¨ŸÖŸäÿπŸáÿß ÿ¨ÿßŸáÿ≤ÿ©",
                noOrders: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ŸÑŸÑÿ™ÿ≠ÿ∂Ÿäÿ±.",
                date: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ",
                total: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ",
                cancel: "ÿ•ŸÑÿ∫ÿßÿ°",
                errorLoad: "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™."
            }
        };

        function changeLanguage() {
            const lang = document.getElementById('language').value;
            localStorage.setItem('selectedLanguageCuisine', lang);
            updateLanguage(lang);
        }

        function updateLanguage(lang) {
            // Navbar
            document.getElementById('navbar-title').innerHTML = translations[lang].navbarTitle;
            document.getElementById('logout-btn').textContent = translations[lang].logout;

            // Main
            document.getElementById('main-title').innerHTML = translations[lang].mainTitle;
            document.getElementById('hide-served-label').textContent = translations[lang].hideServed;

            // Footer
            document.getElementById('footer-title').textContent = translations[lang].menuCuisine;
            document.getElementById('footer-madeby').textContent = "¬© " + new Date().getFullYear() + " " + translations[lang].madeBy;

            // Statuts dynamiques des commandes
            document.querySelectorAll('.order-section .rounded-full').forEach(span => {
                let txt = span.textContent.trim();
                if (txt === "Nouvelle" || txt === "New" || txt === "ÿ¨ÿØŸäÿØ") span.textContent = translations[lang].statusNouvelle;
                if (txt === "Pr√©paration" || txt === "Preparation" || txt === "ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±") span.textContent = translations[lang].statusPreparation;
                if (txt === "Pr√™te" || txt === "Ready" || txt === "ÿ¨ÿßŸáÿ≤") span.textContent = translations[lang].statusPrete;
                if (txt === "Servie" || txt === "Served" || txt === "ŸÖŸÇÿØŸÖ") span.textContent = translations[lang].statusServie;
            });

            // Statuts dynamiques des plats
            document.querySelectorAll('.item-block .rounded-full').forEach(span => {
                let txt = span.textContent.trim();
                if (txt === "Nouvelle" || txt === "New" || txt === "ÿ¨ÿØŸäÿØ") span.textContent = translations[lang].statusNouvelle;
                if (txt === "Pr√©paration" || txt === "Preparation" || txt === "ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±") span.textContent = translations[lang].statusPreparation;
                if (txt === "Pr√™te" || txt === "Ready" || txt === "ÿ¨ÿßŸáÿ≤") span.textContent = translations[lang].statusPrete;
                if (txt === "Servie" || txt === "Served" || txt === "ŸÖŸÇÿØŸÖ") span.textContent = translations[lang].statusServie;
            });

            // Boutons de validation
            document.querySelectorAll('button[type="submit"]').forEach(btn => {
                if (["OK", "ŸÖŸàÿßŸÅŸÇ"].includes(btn.textContent.trim())) btn.textContent = translations[lang].ok;
                if (["Tout en pr√©paration", "All to preparation", "ÿ¨ŸÖŸäÿπŸáÿß ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±"].includes(btn.textContent.trim())) btn.textContent = translations[lang].allPreparation;
                if (["Tout pr√™t", "All ready", "ÿ¨ŸÖŸäÿπŸáÿß ÿ¨ÿßŸáÿ≤ÿ©"].includes(btn.textContent.trim())) btn.textContent = translations[lang].allReady;
            });

            // Message si aucune commande
            const noOrdersDiv = document.querySelector('.noOrders');
            if (noOrdersDiv) noOrdersDiv.textContent = translations[lang].noOrders;
        }

        // Initialisation unique au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const savedLang = localStorage.getItem('selectedLanguageCuisine') || 'fr';
            document.getElementById('language').value = savedLang;
            updateLanguage(savedLang);

            // Si tu utilises un fetch dynamique, appelle updateLanguage √† la fin du fetch
            // Exemple :
            // fetch(...).then(...).then(() => updateLanguage(savedLang));
        });

        // Si tu utilises un fetch pour charger dynamiquement les commandes,
        // assure-toi d'appeler updateLanguage(lang) apr√®s avoir inject√© le HTML.
    </script>
</body>
</html>
